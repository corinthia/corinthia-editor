<!DOCTYPE html>
<html>
<head>
<style>
p { border: 1px solid red;
font-size: 20px;
font-family: monospace;
width: 400px; }
</style>
<script>

function getNodeArrayText(nodes)
{
    var strings = new Array();
    for (var i = 0; i < nodes.length; i++)
        strings.push(getNodeText(nodes[i]));
    return strings.join("");
}

function textBetweenPositions(from,to)
{
    var range = new Range(from.node,from.offset,to.node,to.offset);
    var contents = range.cloneContents();
    return getNodeArrayText(contents);
}

function performTest()
{
    var start = new Position(document.body,0);
    var end = new Position(document.body,document.body.childNodes.length);
    var lines = new Array();


    for (var pos = start; pos != null; pos = pos.next()) {

        var oldBefore = textBetweenPositions(start,pos);
        var oldAfter = textBetweenPositions(pos,end);
        var oldTotal = oldBefore+"|"+oldAfter;


        Selection_set(pos.node,pos.offset,pos.node,pos.offset);
        Cursor_moveToStartOfWord();
        var newPos = Selection_get().start;
        
        var newBefore = textBetweenPositions(start,newPos);
        var newAfter = textBetweenPositions(newPos,end);
        var newTotal = newBefore+"|"+newAfter;


        lines.push(JSON.stringify(oldTotal.trim())+
                   " -> "+
                   JSON.stringify(newTotal.trim()));
    }

    return lines.join("\n");
}
</script>
</head>
<body>

<p>One Two <i>AB<b>CD<u>EF</u>GH</b>IJ</i> Th[]ree Four</p>

</body>
</html>
